---
layout:     post
title:      "Smbtouch漏洞判断与FuzzBunch攻击说明"
subtitle:   "EternalRomance, Eternalchampion, Eternalblue and Eternalsynergy"
date:       2017-05-01
author:     "Urahara"
categories: [Pentest, Red Team, FuzzBunch]

---



###  简介

距离Shadow Brokers公布方程式泄漏的工具及漏洞已有两周多了，但是大家对泄漏内容的研究热情还是很高，说实话主要是料比较多。期间也有几个小伙伴问我关于Eternalchampion等其他漏洞的利用，网上炒的比较多的一直都是Eternalblue，我上一篇[博文](http://reverse-tcp.xyz/2017/04/17/Equation-Group-Dump-Analysis-and-MS17-010-RCE/)也是以Eternalblue来进行介绍的，所以就花点时间研究一下，整理各漏洞的利用方法供各位表哥参考，欢迎吐槽。

### 攻击指引

相信看过我上一篇[博文](http://reverse-tcp.xyz/2017/04/17/Equation-Group-Dump-Analysis-and-MS17-010-RCE/)的小伙伴应该对FuzzBunch和DanderSpritz的使用有了一定的了解了，所以漏洞利用步骤表哥们点击Notice下的Exploit查看，这里就不一一截图了。

| NAME            | TARG            | AFFECT                                  |                  NOTICE                  |
| --------------- | --------------- | :-------------------------------------- | :--------------------------------------: |
| Eternalchampion | SMBv1/SMBv2?    | Win xp\|vista\|7\|8\|2k\|2k3\|2k8\|2k12 | [Exploit](https://github.com/Urahara3389/FuzzBunch-Exploit-Notice/blob/master/Eternalchampion%20exploit.md) |
| EternalRomance  | SMBv1           | Win xp\|vista\|7\|2k3\|2k8              | [Exploit](https://github.com/Urahara3389/FuzzBunch-Exploit-Notice/blob/master/EternalRomance%20exploit.md) |
| Eternalsynergy  | SMBv3           | Win 8 sp0\|2k12 sp0                     |                                          |
| Eternalblue     | SMBv1+SMBv2/NBT | Win xp\|vista\|7\|2k\|2k3\|2k8          | [Exploit](https://github.com/Urahara3389/FuzzBunch-Exploit-Notice/blob/master/Eternalblue%20exploit.md) |

**注：**Eternalsynergy利用时target只涉及win8 sp0 64bit和server 2012 sp0 64bit的操作系统，应该是指RTM版，但在利用时Eternalsynergy-1.0.1.exe会提示停止工作，还未成功，如果哪位小伙伴有研究可以交流一下。

### Smbtouch漏洞判断

Smbtouch在我的上一篇博文中有介绍过，它可以用来检查目标是否易受Eternalblue等Samba漏洞的攻击，辅助攻击者进行相关漏洞利用前的踩点工作。在FuzzBunch中可通过设置target对单个目标进行Smbtouch判断，其实这样在内网渗透等场景下的利用是不太方便的，现在有做过安全评估的企业及单位是很少在公网开放445端口的，但是在内网环境当windows的服务器及办公网是没有对smb端口进行限制的，所以在这种攻击场景下如果可以批量进行smbtouch判断就可以省去很多的攻击成本，因此就写了***SmbtouchBatchScan***进行多任务Smbtouch扫描。

Usage：Usage: SmbtouchBatchScan.py \<start-ip\> \<end-ip\>

![SmbtouchBatchScan](http://reverse-tcp.xyz/static/img/_posts/FuzzBunch/SmbtouchBatchScan.png)

该工具是[三好学生](https://3gstudent.github.io/3gstudent.github.io/内网安全-利用NSA-Smbtouch批量检测内网/)写的SmbtouchScanner的改进版，本来打算自己写一个，正好看到大神已经写出来了，那只好优化一下了。

[项目地址](https://github.com/Urahara3389/SmbtouchBatchScan)



